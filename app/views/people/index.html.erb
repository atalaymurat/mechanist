<h1 class="text-center">People (<%= @people_count %>)</h1>
  <div class="container-fluid">
      <%= link_to 'New Person', new_person_path, class: "btn btn-primary mb-2" %>
      <%= link_to "Import CSV", import_people_path, class: "btn btn-primary mb-2", method: :get  %>

    <div class="card my-2 p-4">
      <%= search_form_for @search do |f| %>
        <div class="form-row">
          <div class="form-group col-md">
            <%= f.label :first_name_cont_or_middle_name_cont_or_last_name_cont, "Full Name" %>
            <%= f.text_field :first_name_or_middle_name_or_last_name_cont, class: "form-control" %>
          </div>
          <div class="form-group col-md">
            <%= f.label :id_eq, "Id" %>
            <%= f.text_field :id_eq, class: "form-control" %>
          </div>
          <div class="form-group col-md">
            <%= f.label :user_id_eq, "User" %>
            <%= f.collection_select :user_id_eq, User.all, :id, :username, {include_blank: true, prompt: "Choose.."} ,class: "form-control" %>
          </div>
        </div>
      <%= f.submit "Search", class: "btn btn-outline-primary btn-sm"%>
    <% end %>
    </div>
    <nav class="navbar bg-light navbar-dark mb-2">
    <ul class="nav">
      <li class="nav-item mx-2">
      <%= sort_link @search, :first_name, "Sort by Name", class: "nav-link"%>
      </li>
      <li class="nav-item mx-2">
      <%= sort_link @search, :id, "Sort by id",class: "nav-link" %>
      </li>
    </ul>
    </nav>

    <div class="row">
      <% @people.each do |person| %>
        <div class="col-sm-12 col-md-6 col-lg-4 mb-2">
          <div class="card h-100">
            <div class="card-header">
              <div class="row">
                <div class="col-10">
                  <%= link_to person.full_name.truncate(20), person, class: "card-title" %>
                </div>
                <div class="col-2">
                <span class="badge"><%= person.id %> </span>
                </div>
              </div>
            </div>
            <div class="card-body">
              <% person.phones.each do |phone| %>
                <h6 class="card-subtitle mb-2">
                <%= fa_icon "mobile-alt" %>
                <%= number_to_phone(phone.phone_number, delimiter: " ", area_code: true) %> </h6>
              <% end %>
              <% person.companies.each do |company| %>
                <h6 class="card-subtitle mb-1"> 
                  <%= fa_icon("cog") %>
              <%= link_to company.name.capitalize.truncate(16),company %> </h6>
              <% end %>
              <p class="card-text"> <small class="text-muted">by <%= person.user.username %> </small></p>
            </div>
            <div class="card-footer">
              <%= link_to fa_icon("edit", type: :regular), edit_person_path(person), class: 'card-link' if policy(person).update? %>
            
              <%= link_to fa_icon("trash-alt", type: :regular, style: "color: red"), person, method: :delete, data: { confirm: 'Are you sure?' }, class: 'card-link float-right' if policy(person).destroy? %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <div class="row justify-content-center"> <%= pagy_bootstrap_nav(@pagy).html_safe %> </div>
    </div>
  </div>
